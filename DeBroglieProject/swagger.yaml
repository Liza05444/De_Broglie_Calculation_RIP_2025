openapi: 3.0.3
info:
  title: De Broglie Project API
  description: |
    API для системы расчета длины волны де Бройля для различных частиц.
    
    Система позволяет:
    - Зарегистрироваться и управлять настройками личного кабинета
    - Создавать частицы и управлять ими
    - Формировать заявки на расчет длины волны де Бройля
    - Выполнять расчеты для различных частиц с заданной скоростью
    
    ## Статусы заявок
    - `черновик` - заявка в процессе формирования
    - `сформирован` - заявка готова к обработке
    - `завершён` - заявка обработана
    - `отклонён` - заявка отклонена
    - `удалён` - заявка удалена
  version: 1.0.0
  contact:
    name: Elizaveta Br

servers:
  - url: http://127.0.0.1:8080
    description: Local server

tags:
  - name: Profile
    description: Аутентификация и управление личным кабинетом
  - name: Particles
    description: Управление частицами
  - name: De Broglie Calculations
    description: Расчеты длины волны де Бройля
  - name: Request for De Broglie Calculations
    description: Заявки на расчет длины волны де Бройля

paths:
  /api/profile/register:
    post:
      tags:
        - Profile
      summary: Регистрация нового пользователя
      description: Создает нового пользователя в системе
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
            example:
              email: "user@example.com"
              password: "password123"
              name: "Пользователь"
              is_moderator: false
      responses:
        '201':
          description: Пользователь успешно создан
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/User'
              example:
                status: "success"
                data:
                  id: 1
                  email: "user@example.com"
                  name: "Пользователь"
                  is_moderator: false
        '400':
          description: Ошибка валидации данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/profile/login:
    post:
      tags:
        - Profile
      summary: Вход в систему
      description: Аутентификация пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
            example:
              email: "user@example.com"
              password: "password123"
      responses:
        '200':
          description: Успешная аутентификация
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          description: Неверные учетные данные
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/profile/logout:
    post:
      tags:
        - Profile
      summary: Выход из системы
      description: Завершение сессии пользователя
      responses:
        '200':
          description: Успешный выход
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "logged out"

  /api/profile/me:
    get:
      tags:
        - Profile
      summary: Получить информацию о текущем пользователе
      description: Возвращает данные текущего авторизованного пользователя
      responses:
        '200':
          description: Информация о пользователе
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/User'
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Profile
      summary: Обновить профиль пользователя
      description: Обновляет данные текущего пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
            example:
              name: "Updated Name"
              is_moderator: false
      responses:
        '200':
          description: Профиль успешно обновлен
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/User'
        '400':
          description: Ошибка валидации данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/particles:
    get:
      tags:
        - Particles
      summary: Получить список частиц
      description: Возвращает список всех частиц с возможностью фильтрации
      parameters:
        - name: particle
          in: query
          description: Фильтр по названию частицы
          required: false
          schema:
            type: string
          example: "электрон"
      responses:
        '200':
          description: Список частиц
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Particle'
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Particles
      summary: Создать новую частицу
      description: Создает новую частицу в системе
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Particle'
            example:
              name: "электрон"
              mass: 9.10938356e-31
              description: "Элементарная частица с отрицательным зарядом"
      responses:
        '201':
          description: Частица успешно создана
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/Particle'
        '400':
          description: Ошибка валидации данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/particles/{id}:
    get:
      tags:
        - Particles
      summary: Получить частицу по ID
      description: Возвращает информацию о конкретной частице
      parameters:
        - name: id
          in: path
          required: true
          description: ID частицы
          schema:
            type: integer
            format: uint64
          example: 1
      responses:
        '200':
          description: Информация о частице
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/Particle'
        '400':
          description: Некорректный ID частицы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Частица не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Particles
      summary: Обновить частицу
      description: Обновляет данные существующей частицы
      parameters:
        - name: id
          in: path
          required: true
          description: ID частицы
          schema:
            type: integer
            format: uint64
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Particle'
            example:
              name: "Обновленный электрон"
              mass: 9.10938356e-31
              description: "Обновленное описание"
      responses:
        '200':
          description: Частица успешно обновлена
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Частица обновлена"
        '400':
          description: Некорректный ID частицы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Частица не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Particles
      summary: Удалить частицу
      description: Удаляет частицу из системы
      parameters:
        - name: id
          in: path
          required: true
          description: ID частицы
          schema:
            type: integer
            format: uint64
          example: 1
      responses:
        '200':
          description: Частица успешно удалена
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Частица удалена"
        '400':
          description: Некорректный ID частицы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Частица не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/particles/{id}/image:
    post:
      tags:
        - Particles
      summary: Загрузить изображение частицы
      description: Загружает изображение для частицы
      parameters:
        - name: id
          in: path
          required: true
          description: ID частицы
          schema:
            type: integer
            format: uint64
          example: 1
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: Файл изображения
      responses:
        '200':
          description: Изображение успешно загружено
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Изображение загружено"
                  image_path:
                    type: string
                    example: "http://127.0.0.1:9000/particles/particle_1.png"
        '400':
          description: Некорректный ID частицы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Частица не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/particles/{id}/addParticle:
    post:
      tags:
        - Particles
      summary: Добавить частицу в заявку
      description: Добавляет частицу в черновик заявки на расчет
      parameters:
        - name: id
          in: path
          required: true
          description: ID частицы
          schema:
            type: integer
            format: uint64
          example: 1
      responses:
        '200':
          description: Частица добавлена в заявку
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Частица добавлена в заявку"
                  draft_id:
                    type: integer
                    format: uint32
                    example: 1
        '400':
          description: Некорректный ID частицы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/requestdebrogliecalculations/cart:
    get:
      tags:
        - Request for De Broglie Calculations
      summary: Получить информацию о корзине
      description: Возвращает информацию о текущем черновике заявки
      responses:
        '200':
          description: Информация о корзине
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      draft_id:
                        type: integer
                        format: uint64
                        example: 1
                      particles_cnt:
                        type: integer
                        example: 3

  /api/requestdebrogliecalculations:
    get:
      tags:
        - Request for De Broglie Calculations
      summary: Получить список заявок
      description: Возвращает список заявок с возможностью фильтрации
      parameters:
        - name: status
          in: query
          description: Фильтр по статусу заявки
          required: false
          schema:
            $ref: '#/components/schemas/RequestStatus'
          example: "черновик"
        - name: start_date
          in: query
          description: Начальная дата (YYYY-MM-DD)
          required: false
          schema:
            type: string
            format: date
          example: "2024-01-01"
        - name: end_date
          in: query
          description: Конечная дата (YYYY-MM-DD)
          required: false
          schema:
            type: string
            format: date
          example: "2024-12-31"
      responses:
        '200':
          description: Список заявок
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/RequestDeBroglieCalculation'

  /api/requestdebrogliecalculations/{id}:
    get:
      tags:
        - Request for De Broglie Calculations
      summary: Получить заявку по ID
      description: Возвращает информацию о заявке с расчетами
      parameters:
        - name: id
          in: path
          required: true
          description: ID заявки
          schema:
            type: integer
            format: uint64
          example: 1
      responses:
        '200':
          description: Информация о заявке
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      request:
                        $ref: '#/components/schemas/RequestDeBroglieCalculation'
                      calculations:
                        type: array
                        items:
                          $ref: '#/components/schemas/DeBroglieCalculation'
        '400':
          description: Некорректный ID заявки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Заявка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Request for De Broglie Calculations
      summary: Обновить заявку
      description: Обновляет данные заявки
      parameters:
        - name: id
          in: path
          required: true
          description: ID заявки
          schema:
            type: integer
            format: uint64
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RequestDeBroglieCalculation'
            example:
              name: "Обновленное название заявки"
      responses:
        '200':
          description: Заявка успешно обновлена
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Заявка обновлена"
        '400':
          description: Некорректный ID заявки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Заявка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Request for De Broglie Calculations
      summary: Удалить заявку
      description: Удаляет заявку из системы
      parameters:
        - name: id
          in: path
          required: true
          description: ID заявки
          schema:
            type: integer
            format: uint64
          example: 1
      responses:
        '200':
          description: Заявка успешно удалена
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Заявка удалена"
        '400':
          description: Некорректный ID заявки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Заявка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/requestdebrogliecalculations/{id}/form:
    put:
      tags:
        - Request for De Broglie Calculations
      summary: Сформировать заявку
      description: Переводит заявку из статуса "черновик" в "сформирован"
      parameters:
        - name: id
          in: path
          required: true
          description: ID заявки
          schema:
            type: integer
            format: uint64
          example: 1
      responses:
        '200':
          description: Заявка успешно сформирована
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Заявка сформирована"
        '400':
          description: Ошибка при формировании заявки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/requestdebrogliecalculations/{id}/complete:
    put:
      tags:
        - Request for De Broglie Calculations
      summary: Завершить заявку
      description: Переводит заявку в статус "завершён" и выполняет расчеты
      parameters:
        - name: id
          in: path
          required: true
          description: ID заявки
          schema:
            type: integer
            format: uint64
          example: 1
      responses:
        '200':
          description: Заявка успешно обработана
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Заявка обработана"
        '400':
          description: Ошибка при обработке заявки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/debrogliecalculations/{id}/particle/{particleId}:
    put:
      tags:
        - De Broglie Calculations
      summary: Обновить скорость частицы в заявке
      description: Обновляет скорость частицы для расчета длины волны де Бройля
      parameters:
        - name: id
          in: path
          required: true
          description: ID заявки
          schema:
            type: integer
            format: uint64
          example: 1
        - name: particleId
          in: path
          required: true
          description: ID частицы
          schema:
            type: integer
            format: uint64
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                speed:
                  type: number
                  format: double
                  minimum: 0
                  description: Скорость частицы в м/с
                  example: 1000000
            example:
              speed: 1000000
      responses:
        '200':
          description: Скорость успешно обновлена
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Скорость обновлена"
        '400':
          description: Ошибка валидации данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Запись не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - De Broglie Calculations
      summary: Удалить частицу из заявки
      description: Удаляет частицу из заявки на расчет
      parameters:
        - name: id
          in: path
          required: true
          description: ID заявки
          schema:
            type: integer
            format: uint64
          example: 1
        - name: particleId
          in: path
          required: true
          description: ID частицы
          schema:
            type: integer
            format: uint64
          example: 1
      responses:
        '200':
          description: Частица успешно удалена из заявки
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Частица удалена из заявки"
        '400':
          description: Некорректный ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Запись не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          description: Статус ответа
          example: "error"
        description:
          type: string
          description: Описание ошибки
          example: "Произошла ошибка при выполнении операции"

    User:
      type: object
      properties:
        id:
          type: integer
          format: uint64
          description: Уникальный идентификатор пользователя
          example: 1
        email:
          type: string
          format: email
          description: Email пользователя
          example: "user@example.com"
        name:
          type: string
          minLength: 3
          maxLength: 25
          description: Имя пользователя
          example: "John Doe"
        password:
          type: string
          minLength: 4
          maxLength: 50
          description: Пароль пользователя
          example: "password123"
        is_moderator:
          type: boolean
          description: Является ли пользователь модератором
          example: false

    Particle:
      type: object
      properties:
        id:
          type: integer
          format: uint64
          description: Уникальный идентификатор частицы
          example: 1
        name:
          type: string
          description: Название частицы
          example: "электрон"
        mass:
          type: number
          format: double
          minimum: 0
          exclusiveMinimum: true
          description: Масса частицы в кг
          example: 9.10938356e-31
        image:
          type: string
          nullable: true
          description: URL изображения частицы
          example: "http://127.0.0.1:9000/particles/particle_1.png"
        description:
          type: string
          nullable: true
          description: Описание частицы
          example: "Элементарная частица с отрицательным зарядом"

    RequestStatus:
      type: string
      enum:
        - "черновик"
        - "удалён"
        - "сформирован"
        - "завершён"
        - "отклонён"
      description: Статус заявки на расчет
      example: "черновик"

    RequestDeBroglieCalculation:
      type: object
      properties:
        id:
          type: integer
          format: uint64
          description: Уникальный идентификатор заявки
          example: 1
        name:
          type: string
          description: Название заявки
          example: "Эксперимент"
        status:
          $ref: '#/components/schemas/RequestStatus'
        created_at:
          type: string
          format: date-time
          description: Дата создания заявки
          example: "2024-01-01T10:00:00Z"
        formed_at:
          type: string
          format: date-time
          nullable: true
          description: Дата формирования заявки
          example: "2024-01-01T11:00:00Z"
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Дата завершения заявки
          example: "2024-01-01T12:00:00Z"
        creator_id:
          type: integer
          format: uint64
          description: ID создателя заявки
          example: 1
        moderator_id:
          type: integer
          format: uint64
          nullable: true
          description: ID модератора
          example: 2
        creator:
          $ref: '#/components/schemas/User'
        moderator:
          $ref: '#/components/schemas/User'

    DeBroglieCalculation:
      type: object
      properties:
        id:
          type: integer
          format: uint64
          description: Уникальный идентификатор расчета
          example: 1
        request_de_broglie_calculation_id:
          type: integer
          format: uint64
          description: ID заявки
          example: 1
        particle_id:
          type: integer
          format: uint64
          description: ID частицы
          example: 1
        speed:
          type: number
          format: double
          description: Скорость частицы в м/с
          example: 1000000
        de_broglie_length:
          type: number
          format: double
          nullable: true
          description: Длина волны де Бройля в м
          example: 7.27e-10
        request:
          $ref: '#/components/schemas/RequestDeBroglieCalculation'
        particle:
          $ref: '#/components/schemas/Particle'
